<!DOCTYPE HTML>
<html>
<head>
<title>Login</title>
<script type="text/javascript" charset="utf-8" src="phonegap-1.2.0.min.js"></script>
<link rel="stylesheet" href="jquery.mobile-1.0.min.css" /> 
<style>

 .alternateRow { border-bottom: 1px solid #f0f0f0; background: #eeeeee; }

</style>

<script src="jquery.min.js"></script> 
<script src="jquery.mobile-1.0.min.js"></script>

<script type="text/javascript">
$( function() {
	
	//window.localStorage.clear();
	$("#pageTitle").html("Welcome " + window.localStorage.getItem("alias"));
	
	$.ajax({ url: "http://mobiletest.proofing.wired.co.nz/JsonService.asmx/GetPraylist",
		data: {},
		dataType: "jsonp",
		success: function(json) {		
			alert(json.d);
			dataTable = json.d.mydt;
			outputDataTable(dataTable); // output the datatable
		},
		error: function() {
			alert("Hit error fn!");
		}
	});
	
	
	// Output datatable to a grid table display
    function outputDataTable(dataTable) {
        var headers = [];
        var rows = [];
        var count = 0;
        var i = 0;
        //totalCount = 0;

        //headers.push("<thead><tr>");
        //for (var name in dataTable[0])
        //   headers.push("<th><b>" + name + "</b></th>");
        //headers.push("</tr></thead>");

        //alert(dataTable.length);

        //datatable contain fn-firstname, ln-lastname, em-email

        //RangeFrom = currentPage * pageSize; //calculate which recipient start according to the page number
        //RangeTo = parseInt(RangeFrom) + parseInt(pageSize); //calculate which recipient show the end according to the page number

        totalCount = 0;
       

        //alert(RangeFrom + ", " + RangeTo);
		alert(dataTable.length);
        for (i = 0; i < dataTable.length; i++) {
            boolCount = false;
			var myDate = new Date(dataTable[i]["DatePosted"].toString());
			
            strRow = "<tr><td>" + dataTable[i]["Alias"] + " - " + dataTable[i]["DatePosted"] + "<br />" + dataTable[i]["Title"] + "<br />" + dataTable[i]["Message"] + "<br /> ";
			
            strRow += "<a href='#' id='prayed" + dataTable[i]["mid"] + "'>Prayed</a> Comment Watchlist</td></tr>";

            rows.push(strRow);
        }

        $("#tbPraylist tbody").html(rows.join(''));

        $("#tbPraylist tr:even").removeClass("alternateRow").addClass("alternateRow"); //give alternate color in the table

        // Reset edit detail button and set the onclick event                       
        //$(".editRecipient").unbind('click');
        //$(".editRecipient").click(function () {
            
        //    return false;
        //});
    }
	
	
	
	
	
	// Signup page info
	function checkLength( o, min, max ) {
		if ( o.val().length > max || o.val().length < min ) {
			return false;
		} else {
			return true;
		}
	}

	function checkRegexp( o, regexp) {
		if ( !( regexp.test( o.val() ) ) ) {
			return false;
		} else {
			return true;
		}
	}
	
	function userSignup(email, password, alias) {				
		$.ajax({ url: "http://mobiletest.proofing.wired.co.nz/JsonService.asmx/UserSignup",
			data: { email: JSON.stringify(email), password: JSON.stringify(password), alias: JSON.stringify(alias) },
			dataType: "jsonp",
			success: function(json) {
				if (json.d == "") {
					alert("Cannot insert");
				}
				else {
					alert("memberID: " + json.d);
				}
			},
			error: function() {
				alert("Hit error fn!");
			}
		});	
	}
		
	$("#btnSignup").click(function() {			
		var email = $( "#sEmail" ),
			password = $( "#sPassword" ),
			passwordConfirm = $( "#sPasswordConfirm" ),
			alias = $( "#sAlias" );
			
		var bValid = true;
		var errorMsg = "";
		
		
		if (!checkLength( password, 6, 16 )) {
			errorMsg += "Password must be between 6 to 16 characters. \n";
			bValid = false;
		}
		if (!checkLength( email, 6, 80 )) {
			errorMsg += "Please enter a proper email. \n";
			bValid = false;
		}
		if (!checkLength( alias, 3, 16 )) {
			errorMsg += "Your alias name must be between 3 to 16 character. \n";
			bValid = false;
		}					
		if (!checkRegexp( email, /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)) {
			errorMsg += "Your email address is incorrect format. \n";
			bValid = false;
		}
		if (passwordConfirm.val() != password.val()) {
			errorMsg += "Your confirm password field must same as your password. \n";
			bValid = false;
		}
		
		// call ajax to check whether email already existed
		$.ajax({ url: "http://mobiletest.proofing.wired.co.nz/JsonService.asmx/CheckEmailExisted",
			data: { email: JSON.stringify(email.val()) },
			dataType: "jsonp",
			async: false,
			success: function(json) {
				if (json.d == "existed") {
					errorMsg += "Your email address is already existed. \n";
					bValid = false;		
				}				
				if (!bValid) {
					alert(errorMsg);
				}
				else {
					userSignup(email.val(), password.val(), alias.val());
				}
			},
			error: function() {
				alert("Hit error fn!");
			}
		});	
	});
	
	
	// forgot password info
	// something here
	
	
	
	
	
	document.addEventListener("deviceready", onDeviceReady, false);			
	
});
// PhoneGap is loaded and it is now safe to make calls PhoneGap methods
function onDeviceReady() {
	navigator.network.isReachable('phonegap.com', reachableCallback);
}
</script>  
</head>
<body>
	<div data-role="page" id="Main"> 
		<div data-role="header"> 
			<h1 id="pageTitle">Welcome </h1> 
		</div> 
		<div data-role="content">
			<table id="tbPraylist" width="100%" cellpadding="4" cellspacing="0">
				<tbody>
				
				</tbody>
			</table>
		</div> 
	</div> 	
	<div data-role="page" id="signup"> 
		<div data-role="header"> 
			<h1>Signup</h1> 
		</div>
		<div data-role="content"> 
			
		</div> 
	</div>
	<div data-role="page" id="forgotpassword"> 
		<div data-role="header"> 
			<h1>Forgot your password</h1> 
		</div> 
		<div data-role="content"> 
	         <label for="fpEmail">Please enter your email address:</label>
	         <input type="text" name="fpEmail" id="fpEmail" value="" placeholder="Email address"/>
			 <button type="submit" id="btnForgotPassword" data-theme="b" data-inline="true">Send password</button>
			 <a data-rel="back" data-role="button" data-theme="c" data-inline="true">Cancel</a>
		</div>
	</div>
</body>
</html>